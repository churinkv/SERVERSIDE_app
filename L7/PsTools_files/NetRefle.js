(function(a){if(!a.Microsoft)a.Microsoft={};if(!a.Microsoft.Mtps)a.Microsoft.Mtps={};a.Microsoft.Mtps.NetReflector=function(a){return this.init(a)};a.extend(a.Microsoft.Mtps.NetReflector.prototype,{cookieOptions:{NRCookieName:"netreflector",ComscoreCookieName:"msresearch",path:"/",domain:".microsoft.com",duration:90},init:function(b){this.brandId=b.brandId;this.surveyUrl=b.surveyUrl;this.throttleRate=b.throttleRate;this.privacyStatementText=b.privacyStatementText;this.trackerWindowText=b.trackerWindowText;this.nrMainPanel=a(".NetReflectorMain");this.nrCloseButton=a(".NRCloseButton");this.nrSubmitButton=a(".NRSubmit");this.nrCancelButton=a(".NRCancel");var c=this;setTimeout(function(){if(c.checkCookie()&&c.getRandom()){c.bindEvent();c.setCookie();c.showPopup()}},3e3)},bindEvent:function(){this.nrCloseButton.bind("click",this,function(a){a.data.nrMainPanel.css("display","none")});this.nrSubmitButton.bind("click",this,function(a){a.data.popupTracker();a.data.nrMainPanel.css("display","none")});this.nrCancelButton.bind("click",this,function(a){a.data.nrMainPanel.css("display","none")})},checkCookie:function(){if(navigator.cookieEnabled){var c=a.cookie(this.cookieOptions.NRCookieName),b=a.cookie(this.cookieOptions.ComscoreCookieName);if(!c&&!b)return true}return false},setCookie:function(){a.cookie(this.cookieOptions.NRCookieName,1,{expires:this.cookieOptions.duration,path:this.cookieOptions.path,domain:this.cookieOptions.domain})},getRandom:function(){var a=Math.random()*100;return a<this.throttleRate?true:false},showPopup:function(){var c=(a(window).height()-this.nrMainPanel.height())/2,b=(a(window).width()-this.nrMainPanel.width())/2;this.nrMainPanel.css("top",c>0?c:0);this.nrMainPanel.css("left",b>0?b:0);this.nrMainPanel.css("display","block");this.addAnimation()},addAnimation:function(){var b=this.nrMainPanel;a(window).resize(function(){b.animate({top:(a(window).height()-b.height())/2,left:(a(window).width()-b.width())/2},500)})},popupTracker:function(){newwindow=window.open("","","height=320px,width=385px,scrollbars=1");newdocument=newwindow.document;newdocument.write(this.getTrackerHtml());newdocument.close()},getTrackerHtml:function(){var a="<html>";a+="<head>";a+="<title>Survey Tracker</title>";a+='<link href="/Areas/Sto/Content/Theming/NetReflector.css" rel="stylesheet" type="text/css" />';a+='<link href="/Areas/Sto/Content/Theming/'+this.brandId+'/NetReflector.css" rel="stylesheet" type="text/css" />';a+="</head>";a+='<body class="NRTrackerBody">';a+='<div class="NRTrackerMain">';a+='<div class="TrackerHeader"></div>';a+='<div class="NRTopStripe"></div>';a+='<div class="NRNotification">';a+="<div>"+this.trackerWindowText+"</div>";a+='<div class="PrivacyStatement"><a href="http://privacy.microsoft.com/">'+this.privacyStatementText+"</a></div></div>";a+='<div class="NRBottomStripe" />';a+="</div>";a+="</body>";a+="</html>";a+='<script type="text/javascript">';a+='var timer = self.setInterval("checkParentWindow()", 1000);';a+="var mainWindow;";a+="function checkParentWindow() {";a+="if (window.opener) {";a+="if (window.opener.closed) { showSurvey(); }";a+="else { try { mainWindow = window.opener.location.href; } catch (ex) { showSurvey(); } } }";a+="else { showSurvey(); } }";a+="function showSurvey() {";a+="timer = window.clearInterval(timer);";a+="window.focus();";a+="window.resizeTo(740, 800);";a+='window.location = "'+this.surveyUrl+'";';a+="timer = window.clearInterval(timer); }";a+="<\/script>";return a}});if(a.Microsoft.Mtps.NetReflectorInit!==undefined){var b=a.Microsoft.Mtps.NetReflectorInit;a(document).ready(function(){new a.Microsoft.Mtps.NetReflector({surveyUrl:b.surveyUrl,throttleRate:b.throttleRate,privacyStatementText:b.privacyStatementText,trackerWindowText:b.trackerWindowText,brandId:b.brandId})})}})(jQuery);